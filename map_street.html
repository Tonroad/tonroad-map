<!DOCTYPE html>
<html>
<head>
  <title>TonRoad Map + Street View + Голосование</title>
  <meta charset="utf-8" />
  <style>
    html, body { margin:0; padding:0; height:100%; }
    #map { height:50%; width:100%; }
    #street-view { height:50%; width:100%; }
    .vote-btn {
      margin-top:5px;
      display:block;
      padding:4px;
      background-color:#4285F4;
      color:white;
      text-align:center;
      cursor:pointer;
      border-radius:4px;
    }
    #modeSwitch {
      position:absolute;
      top:10px;
      right:10px;
      z-index:999;
      padding:8px 14px;
      background-color:#28a745;
      color:white;
      border:none;
      border-radius:4px;
      cursor:pointer;
    }
    #controls {
      position: absolute;
      top: 60px;
      right: 10px;
      z-index: 999;
    }
    #controls button {
      margin: 4px;
      padding: 6px 12px;
    }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <button id="modeSwitch">Режим: Свободная езда</button>
  <div id="controls">
    <button id="forwardBtn">↑ Вперёд</button>
    <button id="backwardBtn">↓ Назад</button>
  </div>
  <div id="map"></div>
  <div id="street-view"></div>

<script>
let map, streetView, voteState = { currentVote:null, routeLine:null }, cityMarkers={}, mode="free";

function initMap() {
  const cities = [
    { name:"Berlin", position:{lat:52.5208, lng:13.4095} },
    { name:"Leipzig", position:{lat:51.3397, lng:12.3731} },
    { name:"Dresden", position:{lat:51.0504, lng:13.7373} },
    { name:"Новороссийск", position:{lat:44.7239, lng:37.7689} }
  ];

  map = new google.maps.Map(document.getElementById("map"), {
    center:cities[0].position,
    zoom:14
  });

  streetView = new google.maps.StreetViewPanorama(document.getElementById("street-view"), {
    position:cities[0].position,
    pov:{heading:0, pitch:0},
    visible:true
  });

  map.setStreetView(streetView);

  cities.forEach(city => {
    const marker = new google.maps.Marker({
      position: city.position,
      map: map,
      title: city.name
    });

    marker.addListener("click", () => {
      map.setCenter(city.position);
      streetView.setPosition(city.position);
      streetView.setPov({heading:0, pitch:0});
    });

    cityMarkers[city.name] = city;
  });
}

// переключатель режимов
document.getElementById("modeSwitch").addEventListener("click", () => {
  if (mode === "free") {
    mode = "vote";
    document.getElementById("modeSwitch").innerText = "Режим: Голосование";
    alert("Включен режим голосования");
  } else {
    mode = "free";
    document.getElementById("modeSwitch").innerText = "Режим: Свободная езда";
    alert("Включен режим свободной езды");
  }
});

// кнопки движения
document.getElementById("forwardBtn").addEventListener("click", () => {
  if (mode === "free") {
    moveStreet(30);
  } else {
    sendVote("forward");
  }
});

document.getElementById("backwardBtn").addEventListener("click", () => {
  if (mode === "free") {
    moveStreet(-30);
  } else {
    sendVote("backward");
  }
});

function moveStreet(step) {
  const pov = streetView.getPov();
  streetView.setPov({
    heading: pov.heading + step,
    pitch: pov.pitch
  });
}

// имитация голосования
function sendVote(direction) {
  // здесь можно прикрутить настоящий API
  console.log(`Голос отправлен: ${direction}`);
  alert(`Вы проголосовали за движение: ${direction}`);
}

</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDLtao0F3Xm136OwD-LFglwhpBdOB6sht8&callback=initMap" async defer></script>
</body>
</html>
