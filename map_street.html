using System;
using System.Collections.Generic;
using System.Linq;
using System.Windows.Forms;

namespace TonRoad
{
    public partial class MainForm : Form
    {
        private enum Mode
        {
            FreeRide,
            Voting
        }

        private Mode currentMode = Mode.FreeRide;

        private int voteLeft = 0;
        private int voteStraight = 0;
        private int voteRight = 0;

        private Button buttonLeft;
        private Button buttonStraight;
        private Button buttonRight;
        private Button buttonGo;

        private Label labelVotes;
        private Label labelStatus;
        private ComboBox comboMode;

        public MainForm()
        {
            InitializeComponent();
            InitializeVotingControls();
            SetMode(Mode.FreeRide);
        }

        private void InitializeVotingControls()
        {
            buttonLeft = new Button { Text = "← Влево", Left = 50, Top = 400, Width = 100 };
            buttonStraight = new Button { Text = "↑ Прямо", Left = 160, Top = 400, Width = 100 };
            buttonRight = new Button { Text = "→ Вправо", Left = 270, Top = 400, Width = 100 };
            buttonGo = new Button { Text = "ЕХАТЬ", Left = 400, Top = 400, Width = 100, BackColor = System.Drawing.Color.Green };

            labelVotes = new Label { Left = 50, Top = 350, Width = 400, Height = 30 };
            labelStatus = new Label { Left = 50, Top = 320, Width = 400, Height = 30 };

            comboMode = new ComboBox { Left = 50, Top = 20, Width = 150 };
            comboMode.Items.Add("Свободная езда");
            comboMode.Items.Add("Голосование");
            comboMode.SelectedIndexChanged += ComboMode_SelectedIndexChanged;
            comboMode.SelectedIndex = 0;

            buttonLeft.Click += (s, e) => Vote("left");
            buttonStraight.Click += (s, e) => Vote("straight");
            buttonRight.Click += (s, e) => Vote("right");
            buttonGo.Click += (s, e) => Drive();

            Controls.Add(buttonLeft);
            Controls.Add(buttonStraight);
            Controls.Add(buttonRight);
            Controls.Add(buttonGo);
            Controls.Add(labelVotes);
            Controls.Add(labelStatus);
            Controls.Add(comboMode);
        }

        private void ComboMode_SelectedIndexChanged(object sender, EventArgs e)
        {
            if (comboMode.SelectedIndex == 0)
            {
                SetMode(Mode.FreeRide);
            }
            else
            {
                SetMode(Mode.Voting);
            }
        }

        private void SetMode(Mode mode)
        {
            currentMode = mode;

            if (currentMode == Mode.Voting)
            {
                buttonLeft.Visible = true;
                buttonStraight.Visible = true;
                buttonRight.Visible = true;
                buttonGo.Visible = true;
                labelStatus.Text = "Режим: Голосование";
                labelStatus.BackColor = System.Drawing.Color.Red;
            }
            else
            {
                buttonLeft.Visible = false;
                buttonStraight.Visible = false;
                buttonRight.Visible = false;
                buttonGo.Visible = false;
                labelStatus.Text = "Режим: Свободная езда";
                labelStatus.BackColor = System.Drawing.Color.Green;
            }

            UpdateVotesLabel();
        }

        private void Vote(string direction)
        {
            if (currentMode != Mode.Voting)
                return;

            switch (direction)
            {
                case "left": voteLeft++; break;
                case "straight": voteStraight++; break;
                case "right": voteRight++; break;
            }
            UpdateVotesLabel();
        }

        private void UpdateVotesLabel()
        {
            labelVotes.Text = $"Влево: {voteLeft} | Прямо: {voteStraight} | Вправо: {voteRight}";
        }

        private void Drive()
        {
            if (currentMode != Mode.Voting)
                return;

            if (voteLeft == 0 && voteStraight == 0 && voteRight == 0)
            {
                labelStatus.Text = "Нет голосов для движения";
                return;
            }

            var winner = new Dictionary<string, int>
            {
                { "left", voteLeft },
                { "straight", voteStraight },
                { "right", voteRight }
            }.OrderByDescending(x => x.Value).First();

            labelStatus.Text = $"Вы поехали как большинство ({winner.Key})";
            voteLeft = 0;
            voteStraight = 0;
            voteRight = 0;

            UpdateVotesLabel();

            // тут можно вставить логику движения машины
            // например вызов Google Street View
        }
    }
}
