<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TonRoad Voting Map</title>
<style>
  body { margin: 0; font-family: Arial, sans-serif; }
  #modeSelector { margin: 5px; }
  #status { 
    padding: 5px; color: white; font-weight: bold; 
    position: absolute; top: 5px; left: 5px; border-radius: 4px;
  }
  #status.voting { background-color: red; }
  #status.freeride { background-color: green; }
  #votes { position: absolute; top: 40px; left: 5px; background: rgba(0,0,0,0.6); color: white; padding: 3px 8px; border-radius: 5px; font-size: 14px; }
  #radioBtn {
    position: absolute; top: 5px; right: 5px; background: orange; color: black; padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;
  }
  #streetView { width: 100vw; height: 60vh; }
  #controls {
    position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
    display: flex; gap: 10px;
  }
  button.voteBtn {
    padding: 10px 15px; font-size: 16px; cursor: pointer;
    border-radius: 6px; border: none;
  }
  button#goBtn {
    background-color: green; color: white; font-weight: bold;
    padding: 10px 25px; font-size: 16px; cursor: pointer;
    border-radius: 6px; border: none;
  }
  button.voteBtn:disabled {
    background-color: #bbb; cursor: not-allowed;
  }
</style>
</head>
<body>

<select id="modeSelector">
  <option value="voting">Голосование</option>
  <option value="freeride">Свободная езда</option>
</select>
<div id="status" class="voting">Режим: Голосование</div>
<div id="votes">Голосов: 0 (Влево: 0, Прямо: 0, Вправо: 0)</div>
<button id="radioBtn">▶ Радио</button>

<div id="streetView"></div>

<div id="controls">
  <button id="btnLeft" class="voteBtn">← Влево</button>
  <button id="btnStraight" class="voteBtn">↑ Прямо</button>
  <button id="btnRight" class="voteBtn">→ Вправо</button>
  <button id="goBtn">Ехать</button>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=ВАШ_КЛЮЧ&libraries=places"></script>
<script>
  // Переменные голосования
  let voteLeft = 0;
  let voteStraight = 0;
  let voteRight = 0;

  const modeSelector = document.getElementById('modeSelector');
  const statusLabel = document.getElementById('status');
  const votesLabel = document.getElementById('votes');
  const btnLeft = document.getElementById('btnLeft');
  const btnStraight = document.getElementById('btnStraight');
  const btnRight = document.getElementById('btnRight');
  const btnGo = document.getElementById('goBtn');
  const radioBtn = document.getElementById('radioBtn');

  // Инициализация карты StreetView
  const sv = new google.maps.StreetViewPanorama(document.getElementById('streetView'), {
    position: {lat: 44.7239, lng: 37.7687}, // Новороссийск
    pov: {heading: 0, pitch: 0},
    visible: true,
    linksControl: true,
    panControl: true,
    enableCloseButton: false
  });

  // Обработчик изменения режима
  function setMode(mode) {
    if (mode === 'voting') {
      statusLabel.textContent = 'Режим: Голосование';
      statusLabel.className = 'voting';
      btnLeft.disabled = false;
      btnStraight.disabled = false;
      btnRight.disabled = false;
      btnGo.disabled = false;
      btnLeft.style.display = 'inline-block';
      btnStraight.style.display = 'inline-block';
      btnRight.style.display = 'inline-block';
      btnGo.style.display = 'inline-block';

      // Отключаем стрелки Google (ссылки) в режиме голосования
      sv.setOptions({
        linksControl: false,
        panControl: false
      });
    } else if (mode === 'freeride') {
      statusLabel.textContent = 'Режим: Свободная езда';
      statusLabel.className = 'freeride';
      btnLeft.style.display = 'none';
      btnStraight.style.display = 'none';
      btnRight.style.display = 'none';
      btnGo.style.display = 'none';

      // Включаем стрелки Google
      sv.setOptions({
        linksControl: true,
        panControl: true
      });
    }
    resetVotes();
  }

  // Обновление надписи голосов
  function updateVotesLabel() {
    const total = voteLeft + voteStraight + voteRight;
    votesLabel.textContent = `Голосов: ${total} (Влево: ${voteLeft}, Прямо: ${voteStraight}, Вправо: ${voteRight})`;
  }

  // Сброс голосов
  function resetVotes() {
    voteLeft = 0;
    voteStraight = 0;
    voteRight = 0;
    updateVotesLabel();
  }

  // Голосование
  function vote(direction) {
    if (modeSelector.value !== 'voting') return;

    if (direction === 'left') voteLeft++;
    else if (direction === 'straight') voteStraight++;
    else if (direction === 'right') voteRight++;

    updateVotesLabel();
  }

  // По нажатию Ехать едем по большинству голосов
  function goDrive() {
    if (modeSelector.value !== 'voting') return;

    const totalVotes = voteLeft + voteStraight + voteRight;
    if (totalVotes === 0) {
      alert('Нет голосов для движения');
      return;
    }

    let maxVotes = Math.max(voteLeft, voteStraight, voteRight);
    let direction = '';
    if (maxVotes === voteLeft) direction = 'left';
    else if (maxVotes === voteStraight) direction = 'straight';
    else if (maxVotes === voteRight) direction = 'right';

    let heading = sv.getPov().heading;

    if (direction === 'left') heading -= 90;
    else if (direction === 'right') heading += 90;
    // Прямо - heading без изменений

    // Нормализуем heading
    if (heading < 0) heading += 360;
    if (heading >= 360) heading -= 360;

    sv.setPov({heading: heading, pitch: 0});

    resetVotes();
  }

  // Обработчики кнопок голосования
  btnLeft.addEventListener('click', () => vote('left'));
  btnStraight.addEventListener('click', () => vote('straight'));
  btnRight.addEventListener('click', () => vote('right'));
  btnGo.addEventListener('click', goDrive);

  // Переключение режимов
  modeSelector.addEventListener('change', (e) => {
    setMode(e.target.value);
  });

  // Инициализация режима по умолчанию
  setMode(modeSelector.value);

  // Кнопка радио (заглушка)
  radioBtn.addEventListener('click', () => alert('Радио пока не реализовано'));
</script>

</body>
</html>
