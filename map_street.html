<!DOCTYPE html>
<html>
<head>
  <title>TonRoad</title>
  <meta charset="utf-8" />
  <style>
    html, body { margin:0; padding:0; height:100%; }
    #map { height:50%; width:100%; }
    #street-view { height:50%; width:100%; }
    #modeStatus {
      position:fixed;
      top:10px;
      left:10px;
      background:#28a745;
      color:white;
      padding:5px 10px;
      border-radius:4px;
      z-index:999;
    }
    #radioBtn {
      position:fixed;
      top:10px;
      right:10px;
      background-color:#f39c12;
      color:white;
      padding:5px 10px;
      border-radius:4px;
      border:none;
      cursor:pointer;
      z-index:999;
    }
    #citySelect {
      position:fixed;
      top:50px;
      left:10px;
      z-index:999;
      padding:5px;
    }
    #controls {
      position:fixed;
      bottom:10px;
      left:50%;
      transform:translateX(-50%);
      z-index:999;
    }
    #controls button {
      padding:10px 14px;
      margin:5px;
      font-size:14px;
    }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div id="modeStatus">Режим: Свободная езда</div>
  <button id="radioBtn">⏸️ Радио</button>
  <select id="citySelect">
    <option value="Berlin">Берлин</option>
    <option value="Leipzig">Лейпциг</option>
    <option value="Dresden">Дрезден</option>
    <option value="Novorossiysk">Новороссийск</option>
  </select>
  <div id="map"></div>
  <div id="street-view"></div>
  <div id="controls">
    <button id="forwardBtn">↑ Вперёд</button>
    <button id="backwardBtn">↓ Назад</button>
  </div>
  <script>
    let map, streetView;
    let voteState = { mode: "free", currentVote: null };
    let cityMarkers = {};
    let currentCity = "Berlin";

    const cities = {
      Berlin: { lat: 52.5200, lng: 13.4050 },
      Leipzig: { lat: 51.3397, lng: 12.3731 },
      Dresden: { lat: 51.0504, lng: 13.7373 },
      Novorossiysk: { lat: 44.7234, lng: 37.7686 }
    };

    const radio = new Audio("https://online.radiorecord.ru:8102/rr_320");
    radio.loop = true;

    function initMap() {
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 14,
        center: cities[currentCity]
      });

      streetView = new google.maps.StreetViewPanorama(document.getElementById("street-view"), {
        position: cities[currentCity],
        pov: { heading: 0, pitch: 0 },
        visible: true
      });
      map.setStreetView(streetView);

      // markers
      for (const [name, position] of Object.entries(cities)) {
        const marker = new google.maps.Marker({
          position,
          map,
          title: name
        });
        cityMarkers[name] = marker;
      }
    }

    document.getElementById("radioBtn").addEventListener("click", () => {
      if (radio.paused) {
        radio.play();
        document.getElementById("radioBtn").innerText = "⏸️ Радио";
      } else {
        radio.pause();
        document.getElementById("radioBtn").innerText = "▶️ Радио";
      }
    });

    document.getElementById("citySelect").addEventListener("change", e => {
      currentCity = e.target.value;
      map.setCenter(cities[currentCity]);
      streetView.setPosition(cities[currentCity]);
      streetView.setPov({ heading: 0, pitch: 0 });
    });

    document.getElementById("forwardBtn").addEventListener("click", () => {
      const pov = streetView.getPov();
      streetView.setPov({ heading: pov.heading, pitch: pov.pitch });
      // движение вперед, ограничение
    });

    document.getElementById("backwardBtn").addEventListener("click", () => {
      const pov = streetView.getPov();
      streetView.setPov({ heading: pov.heading + 180, pitch: pov.pitch });
    });

    document.getElementById("modeStatus").addEventListener("click", () => {
      if (voteState.mode === "free") {
        voteState.mode = "voting";
        document.getElementById("modeStatus").innerText = "Режим: Голосование";
      } else {
        voteState.mode = "free";
        document.getElementById("modeStatus").innerText = "Режим: Свободная езда";
      }
    });
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDLtao0F3Xm136OwD-LFglwhpBdOB6sht8&callback=initMap" async defer></script>
</body>
</html>
