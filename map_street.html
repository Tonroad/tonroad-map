<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TonRoad Голосование</title>
<style>
  body {
    margin: 0; font-family: Arial, sans-serif;
  }
  #map {
    width: 100%;
    height: 50vh;
  }
  #streetView {
    width: 100%;
    height: 50vh;
  }
  #controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 5px 0;
  }
  button {
    font-size: 18px;
    padding: 10px 15px;
    cursor: pointer;
  }
  #modeStatus {
    padding: 8px;
    color: white;
    font-weight: bold;
    text-align: center;
  }
  #votes {
    background-color: rgba(0,0,0,0.6);
    color: white;
    padding: 8px;
    font-size: 16px;
    position: absolute;
    top: 55px;
    left: 10px;
    border-radius: 4px;
    z-index: 5;
  }
  #radioBtn {
    position: absolute;
    top: 55px;
    right: 10px;
    background-color: orange;
    border: none;
    color: white;
    font-size: 18px;
    padding: 6px 12px;
    cursor: pointer;
    z-index: 5;
  }
  #modeSelect, #citySelect {
    margin-left: 10px;
    padding: 5px;
    font-size: 16px;
  }
  #goBtn {
    background-color: green;
    color: white;
    font-weight: bold;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="modeStatus" style="background-color:red;">Режим: Голосование</div>

<select id="modeSelect" aria-label="Выбор режима">
  <option value="voting" selected>Голосование</option>
  <option value="freeride">Свободная езда</option>
</select>

<select id="citySelect" aria-label="Выбор города">
  <option value="Novorossiysk" selected>Новороссийск</option>
  <option value="Moscow">Москва</option>
  <option value="SaintPetersburg">Санкт-Петербург</option>
</select>

<div id="votes">Влево: 0 | Прямо: 0 | Вправо: 0</div>
<button id="radioBtn">Радио ▶</button>

<div id="map"></div>
<div id="streetView"></div>

<div id="controls">
  <button id="btnLeft">← Влево</button>
  <button id="btnStraight">↑ Прямо</button>
  <button id="btnRight">→ Вправо</button>
  <button id="goBtn">Ехать</button>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=ВАШ_КЛЮЧ_ЗДЕСЬ"></script>
<script>
  let map;
  let streetView;
  let panorama;

  let voteLeft = 0;
  let voteStraight = 0;
  let voteRight = 0;

  const btnLeft = document.getElementById('btnLeft');
  const btnStraight = document.getElementById('btnStraight');
  const btnRight = document.getElementById('btnRight');
  const goBtn = document.getElementById('goBtn');
  const votesLabel = document.getElementById('votes');
  const modeStatus = document.getElementById('modeStatus');
  const modeSelect = document.getElementById('modeSelect');
  const citySelect = document.getElementById('citySelect');

  // Координаты для городов
  const cities = {
    Novorossiysk: { lat: 44.723627, lng: 37.768206 },
    Moscow: { lat: 55.7558, lng: 37.6173 },
    SaintPetersburg: { lat: 59.9343, lng: 30.3351 }
  };

  // Текущий режим
  let currentMode = 'voting';

  function updateVotesLabel() {
    votesLabel.textContent = `Влево: ${voteLeft} | Прямо: ${voteStraight} | Вправо: ${voteRight}`;
  }

  function setMode(mode) {
    currentMode = mode;
    if (mode === 'voting') {
      modeStatus.textContent = 'Режим: Голосование';
      modeStatus.style.backgroundColor = 'red';
      btnLeft.style.display = 'inline-block';
      btnStraight.style.display = 'inline-block';
      btnRight.style.display = 'inline-block';
      goBtn.style.display = 'inline-block';

      // Отключаем стрелки Google Street View
      streetView.setOptions({ linksControl: false, panControl: false, addressControl: false, zoomControl: false });

    } else {
      modeStatus.textContent = 'Режим: Свободная езда';
      modeStatus.style.backgroundColor = 'green';
      btnLeft.style.display = 'none';
      btnStraight.style.display = 'none';
      btnRight.style.display = 'none';
      goBtn.style.display = 'none';

      // Включаем стрелки Google Street View
      streetView.setOptions({ linksControl: true, panControl: true, addressControl: true, zoomControl: true });
    }

    resetVotes();
    updateVotesLabel();
  }

  function resetVotes() {
    voteLeft = 0;
    voteStraight = 0;
    voteRight = 0;
  }

  function vote(direction) {
    if (currentMode !== 'voting') return;
    switch(direction) {
      case 'left': voteLeft++; break;
      case 'straight': voteStraight++; break;
      case 'right': voteRight++; break;
    }
    updateVotesLabel();
  }

  function go() {
    if (currentMode !== 'voting') return;
    if (voteLeft === 0 && voteStraight === 0 && voteRight === 0) {
      alert("Нет голосов для движения");
      return;
    }
    // Найти максимальное количество голосов
    const maxVote = Math.max(voteLeft, voteStraight, voteRight);
    let heading = streetView.getPov().heading; // текущий курс

    if (maxVote === voteLeft) {
      heading -= 90;
    } else if (maxVote === voteStraight) {
      // оставляем как есть
    } else if (maxVote === voteRight) {
      heading += 90;
    }

    // Устанавливаем новый POV
    streetView.setPov({ heading: heading, pitch: 0 });
  }

  function initialize() {
    const city = citySelect.value;
    const cityCoords = cities[city];

    map = new google.maps.Map(document.getElementById('map'), {
      center: cityCoords,
      zoom: 14,
      streetViewControl: false
    });

    panorama = new google.maps.StreetViewPanorama(
      document.getElementById('streetView'),
      {
        position: cityCoords,
        pov: { heading: 0, pitch: 0 },
        linksControl: false,
        panControl: false,
        addressControl: false,
        zoomControl: false
      }
    );

    map.setStreetView(panorama);

    streetView = panorama;

    setMode(currentMode);
  }

  // События кнопок голосования
  btnLeft.addEventListener('click', () => vote('left'));
  btnStraight.addEventListener('click', () => vote('straight'));
  btnRight.addEventListener('click', () => vote('right'));
  goBtn.addEventListener('click', go);

  // Переключение режима
  modeSelect.addEventListener('change', () => {
    setMode(modeSelect.value);
  });

  // Переключение города
  citySelect.addEventListener('change', () => {
    const cityCoords = cities[citySelect.value];
    map.setCenter(cityCoords);
    streetView.setPosition(cityCoords);
  });

  window.onload = initialize;
</script>

</body>
</html>
